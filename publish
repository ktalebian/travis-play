# lerna-it

A simple script for publishing Lerna monorepo projects and a CI/CD system such as Travis.

## Installation
Install using

```bash
# If using npm
npm install -D @k88/lerna-it

# If using yarn
yarn add -D @k88/lerna-it
```

## Usage

Add the following scripts to your package.json\'s `scripts`:

```json
{
  "scripts": {
    "release:alpha": "lerna-release alpha",
    "release:beta": "lerna-release beta",
    "release:public": "lerna-release public",
    "publish": "lerna-publish"
  }
}
```

## Details

The `lerna-release` is intended to run on your local machine; it will create a release tag and push the changes up. 

Your CI/CD system should be then be triggered to invoke `lerna-publish` which will perform the following tasks:

1) Check publish version (see below for more detail)
2) Removes all dist/lib/node_modules directory
3) Performs a fresh `npm install`
4) Runs `npm run lint`
5) Runs `npm run test`
6) Runs `npm run build`
7) Publishes the packages

### Publish types

This script safeguards performing `public/beta/alpha` publication based on:

* `public` may only run on `main` branch
* `beta` may only run on `v\d-beta` branch (i.e. `v1-beta`, `v2-beta`, `v3-beta`, etc)
* `alpha` may only run on non-beta/non-publich branches

### Distribution Tags

The following tags are published:

* The `public` publish pushes a `latest` dist tag
* The `beta` publish pushes a `beta` dist tag
* The `alpha` publish pushes a `alpha` dist tag

### Version bump

You can pass an optional `patch/minor/major` argument to change the version bump. By default, a `patch` is published. Some examples are:

```bash
# Publishes a patch beta
npm run release:beta

# Publishes a minor public
npm run release:public minor
```
